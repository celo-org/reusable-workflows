name: Trivy
description: "Run a Trivy Scan and upload the results"
inputs:
  image-ref:
    description: "image to scan"
    required: true
  timeout:
    description: "how long to scan"
    default: 15m
  vuln-type:
    description: "types of vulnerabilities to report"
    default: "os,library"
  severity:
    description: "severity of issues to report"
    default: "UNKNOWN,LOW,MEDIUM,HIGH,CRITICAL"
  format:
    description: "format of scan report"
    default: "sarif"

runs:
  using: "composite"
  steps:
    - name: Run Trivy vulnerability scanner
      uses: aquasecurity/trivy-action@master
      with:         
        image-ref: ${{ inputs.image-ref }}
        timeout: ${{ inputs.timeout }}
        vuln-type: ${{ inputs.vuln-type }}
        severity: ${{ inputs.severity }}
        format: ${{ inputs.format }}
        output: ${{ env.OUTPUT-FILE }}
            
    - name: Upload Trivy scan results to GitHub Security tab
      uses: github/codeql-action/upload-sarif@v3
      with:
        sarif_file: ${{ env.OUTPUT-FILE }}
